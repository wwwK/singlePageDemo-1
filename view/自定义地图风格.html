<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="../js/ol.js"></script>
		<script src="../js/jquery.min.js"></script>
		<style>
			html,
			body,
			.map {
				width: 100%;
				height: 100%;
				margin: 0;
				padding: 0;
			}
		</style>
	</head>

	<body>
		<div class="map" id="map">

		</div>
		<script>
			let map = new ol.Map({
				target: 'map',
				interactions: ol.interaction.defaults({
					altShiftDragRotate: false,
					pinchRotate: false
				}),
				view: new ol.View({
					center: ol.proj.transform([104, 30], 'EPSG:4326', 'EPSG:3857'),
					zoom: 8,
					maxZoom: 18,
					minZoom: 2
				})
			});

			let roadLayer = new ol.layer.Tile({
				title: "3857底图",
				source: new ol.source.XYZ({
					tileUrlFunction: function(tileCoord) {
						let oo = "00000000";
						let zz = tileCoord[0];
						if(zz < 10) {
							zz = '0' + zz;
						}
						let z = "L" + zz;

						let xx = tileCoord[1].toString(16);
						let x = "C" + oo.substring(0, 8 - xx.length) + xx;
						let yy = (-tileCoord[2] - 1).toString(16); //注意此处，计算方式变了
						let y = "R" + oo.substring(0, 8 - yy.length) + yy;
						return 'http://223.86.3.47:28080/api/Handler/Utils.ashx?method=convertImg&x=' + z + '&y=' + y + '&z=' + x
					},
					tileLoadFunction: function(imageTile, src) {
						let img = new Image();
						img.setAttribute('crossOrigin', 'anonymous');
						let canvas = document.createElement("canvas");
						canvas.width = 256;
						canvas.height = 256;
						let ctx = canvas.getContext("2d");
						img.onload = function() {
							console.log(img);
							ctx.drawImage(img, 0, 0, img.width, img.height);
							var imgData = ctx.getImageData(0, 0, img.width, img.height);
							var data = imgData.data;
							for(var i = 0; i < data.length; i += 4) {
								var r = data[i + 0];
								var g = data[i + 1];
								var b = data[i + 2];
								var a = data[i + 3];
								//黑色风格
								//								data[i + 0] =  0 * r + 0 * g + 0 * b + 0 * a + 0
								//								data[i + 1] =  0 * r + 0 * g + 0 * b + 0 * a + 0.77
								//								data[i + 2] =  0 * r + 0 * g + 0 * b + 0 * a + 0.04
								//								data[i + 3] = 0.2126 * r + 0.7152 * g + 0.0722 * b + -0.025 * a - 0.05
								//灰色风格
								data[i + 0] = 0 * r + 1 * g + 0 * b + 0 * a + 0
								data[i + 1] = 0 * r + 1 * g + 0 * b + 0 * a + 0
								data[i + 2] = 0 * r + 1 * g + 0 * b + 0 * a + 0
								data[i + 3] = 0 * r + 1 * g + 0 * b + 1 * a + 0
							}
							ctx.putImageData(imgData, 0, 0);
							let dataURL = canvas.toDataURL("image/png");
							imageTile.getImage().src = dataURL;
						};
						img.src = src;
					},
					projection: 'EPSG:3857'
				})
			});
			map.addLayer(roadLayer);
//常用风格矩阵
//			window.sampleFilters = {
//				original: '1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0',
//				purple: '1 -0.2 0 0 0 0 1 0 -0.1 0 0 1.2 1 0.1 0 0 0 1.7 1 0',
//				yellow: '1 0 0 0 0 -0.2 1.0 0.3 0.1 0 -0.1 0 1 0 0 0 0 0 1 0',
//				cyan: '1 0 0 1.9 -2.2 0 1 0 0.0 0.3 0 0 1 0 0.5 0 0 0 1 0.2',
//				blackWhite: '0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 1 0',
//				oldTimes: '1 0 0 0 0 -0.4 1.3 -0.4 0.2 -0.1 0 0 1 0 0 0 0 0 1 0',
//				coldLife: '1 0 0 0 0 0 1 0 0 0 -0.2 0.2 0.1 0.4 0 0 0 0 1 0',
//				sepium: '0 0 0 0 0 0 0 0 0 0.012 0 0 0 0 0.04 0.2126 0.7152 0.0722 -0.025 -0.05',
//				milk: '0 0 0 0 0 0 0 0 0 0.07 0 0 0 0 0.2 0.2126 0.9152 0.0722 -0.025 -0.05'
//			}
		</script>
	</body>

</html>