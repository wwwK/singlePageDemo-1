<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="../js/ol.js"></script>
		<script src="../js/jquery.min.js"></script>
		<style>
			html,
			body,
			.map {
				width: 100%;
				height: 100%;
				margin: 0;
				padding: 0;
			}
		</style>
	</head>

	<body>
		<div class="map" id="map">

		</div>
		<script>
			let map = new ol.Map({
				target: 'map',
				interactions: ol.interaction.defaults({
					altShiftDragRotate: false,
					pinchRotate: false
				}),
				view: new ol.View({
					center: ol.proj.transform([104, 30], 'EPSG:4326', 'EPSG:3857'),
					zoom: 8,
//					maxZoom: 18,
					minZoom: 2
				})
			});

			let roadLayer = new ol.layer.Tile({
				title: "3857底图",
				source: new ol.source.XYZ({
					tileUrlFunction: function(tileCoord) {
						let oo = "00000000";
						let zz = tileCoord[0];
						if(zz < 10) {
							zz = '0' + zz;
						}
						let z = "L" + zz;

						let xx = tileCoord[1].toString(16);
						let x = "C" + oo.substring(0, 8 - xx.length) + xx;
						let yy = (-tileCoord[2] - 1).toString(16); //注意此处，计算方式变了
						let y = "R" + oo.substring(0, 8 - yy.length) + yy;
						return 'http://223.86.3.47:28080/api/Handler/Utils.ashx?method=convertImg&x=' + z + '&y=' + y + '&z=' + x
					},
					projection: 'EPSG:3857'
				})
			});
			map.addLayer(roadLayer);

			let rangeLyaer = new ol.layer.Vector({
				source: new ol.source.Vector({
					features: []
				}),
				style: new ol.style.Style({
					stroke: new ol.style.Stroke({
						color: [216, 76, 41, 1],
						width: 2
					})
				})
			});
			map.addLayer(rangeLyaer);

			var format = new ol.format.WKT();

			var wkrarr = ['MULTILINESTRING((103.541383733 29.4062923000001,103.541383115 29.4062928650001,103.541382859 29.406292781,103.541383733 29.4062923000001),(103.541384138 29.4062919290001,103.541383733 29.4062923000001),(103.541383733 29.4062923000001,103.541500895 29.4062277840001,103.541514651 29.4062203660001,103.541512478 29.4062174650001,103.541436097 29.4060944490001,103.541425371 29.406073845))',
'MULTILINESTRING((103.541425371 29.406073845,103.541391207 29.406008221))',
'MULTILINESTRING((103.541372948 29.4059731470001,103.541391308 29.405967945,103.541414353 29.4059569550001))',
'MULTILINESTRING((103.541414353 29.4059569550001,103.541480116 29.4059255930001))',
'LINESTRING(103.540920485 29.406339524,103.540952715 29.406432065,103.540952846 29.4064322740001,103.541223102 29.4063672290001,103.541226954 29.406365554,103.541217498 29.4063266000001,103.541232438 29.4063227770001,103.541197 29.4062159850001,103.541246614 29.4062072290001,103.541303983 29.4061893030001,103.541372123 29.406298652,103.541385727 29.406291712,103.541385888 29.406291325,103.541384138 29.4062919290001)',
'LINESTRING(103.541544487 29.405653876,103.541567384 29.4056562820001,103.541693792 29.4056889130001,103.541726835 29.4056819680001)',
'LINESTRING(103.541471762 29.4059009750001,103.541397126 29.4057625350001,103.541372849 29.4056995330001,103.541440926 29.405671838)',
'LINESTRING(103.541480116 29.4059255930001,103.541471762 29.4059009750001)',
'LINESTRING(103.541440926 29.405671838,103.541486337 29.4056521740001)',
'LINESTRING(103.541486337 29.4056521740001,103.541495075 29.405648436,103.541502262 29.4056494800001)',
'LINESTRING(103.541502262 29.4056494800001,103.541514213 29.40565156,103.541544487 29.405653876)',
'LINESTRING(103.541391207 29.406008221,103.541372948 29.4059731470001)'];

			for(var i = 0; i < wkrarr.length; i++) {
				let feature = format.readFeature(wkrarr[i])
				let wkt = format.writeFeature(feature, {
					dataProjection: 'EPSG:3857',
					featureProjection: 'EPSG:4326'
				});
				var wktfeature = format.readFeature(wkt);
				rangeLyaer.getSource().addFeature(wktfeature);
			}

			setTimeout(() => {
				let size = map.getSize();
				if(rangeLyaer.getSource().getFeatures().length) {
					let extent = rangeLyaer.getSource().getExtent();
					map.getView().fit(extent, {
						size: [size[0] * 1, size[1] * 1]
					});
				}
			}, 300)
		</script>
	</body>

</html>